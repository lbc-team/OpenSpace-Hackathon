<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solanaéƒ¨ç½²ç»­ä¼ å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card h3 {
            margin-bottom: 16px;
            color: #2d3748;
            display: flex;
            align-items: center;
        }
        
        .card h3::before {
            content: "";
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 12px;
            border-radius: 2px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #4a5568;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .status.warning {
            background: #faf0ce;
            color: #b7791f;
        }
        
        .status.error {
            background: #fed7e2;
            color: #c53030;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn.secondary:hover {
            background: #cbd5e0;
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        .deployment-list {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .deployment-item {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .deployment-item:last-child {
            border-bottom: none;
        }
        
        .deployment-info h4 {
            margin-bottom: 4px;
            color: #2d3748;
        }
        
        .deployment-info p {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .deployment-actions {
            display: flex;
            gap: 8px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .feature-description {
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #4a5568;
            border-left: 4px solid #667eea;
        }
        
        .feature-description h4 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #2d3748;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .form-group small {
            color: #718096;
            font-size: 0.8rem;
        }

        .keypair-selector {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .keypair-selector input[type="text"] {
            flex: 1;
        }

        .btn-secondary {
            background: #4a5568;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background: #2d3748;
        }

        .status-text {
            font-weight: 500;
        }

        .status-text.success {
            color: #38a169;
        }

        .status-text.warning {
            color: #dd6b20;
        }

        .status-text.error {
            color: #e53e3e;
        }
        
        .log-output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Solanaéƒ¨ç½²ç»­ä¼ å·¥å…·</h1>
            <p>æ™ºèƒ½éƒ¨ç½²ç®¡ç† Â· æ–­ç‚¹ç»­ä¼  Â· è´¹ç”¨ä¼˜åŒ–</p>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h3>ğŸ“Š éƒ¨ç½²ç»Ÿè®¡</h3>
                <div class="metric">
                    <span class="metric-label">æ€»éƒ¨ç½²æ•°</span>
                    <span class="metric-value" id="total-deployments">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æˆåŠŸç‡</span>
                    <span class="metric-value" id="success-rate">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">èŠ‚çœè´¹ç”¨</span>
                    <span class="metric-value" id="saved-fees">0 SOL</span>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸŒ ç½‘ç»œçŠ¶å†µ</h3>
                <div class="metric">
                    <span class="metric-label">RPCå»¶è¿Ÿ</span>
                    <span class="metric-value" id="network-latency">
                        <span class="loading"></span>
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">ç½‘ç»œæ‹¥å µ</span>
                    <span class="metric-value" id="congestion-level">
                        <span class="status warning">æ£€æµ‹ä¸­</span>
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Gasè´¹ç”¨</span>
                    <span class="metric-value" id="gas-price">-- SOL</span>
                </div>
            </div>
            
            <div class="card">
                <h3>âš¡ ä¸»è¦åŠŸèƒ½</h3>
                
                <div class="feature-description">
                    <h4>ğŸ†• æ–°å»ºéƒ¨ç½²</h4>
                    <p>æ™ºèƒ½åˆ†æ.soæ–‡ä»¶ï¼Œè‡ªåŠ¨æ‹†åˆ†ä¸Šä¼ ï¼Œå®æ—¶ç›‘æ§éƒ¨ç½²è¿›åº¦ã€‚æ”¯æŒLoader-v3/v4ï¼Œä¼˜åŒ–äº¤æ˜“è´¹ç”¨ã€‚</p>
                </div>
                <button class="btn" onclick="openNewDeploymentModal()">æ–°å»ºéƒ¨ç½²</button>
                
                <div class="feature-description" style="border-left-color: #f56565;">
                    <h4>ğŸ§ª æµ‹è¯•å¤±è´¥éƒ¨ç½²</h4>
                    <p>æ¨¡æ‹Ÿéƒ¨ç½²å¤±è´¥åœºæ™¯ï¼Œæµ‹è¯•ç»­ä¼ åŠŸèƒ½ã€‚ç”¨äºéªŒè¯æ–­ç‚¹ç»­ä¼ çš„å¯é æ€§ã€‚</p>
                </div>
                <button class="btn" style="background: #f56565;" onclick="openFailureTestModal()">æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²</button>
                
                <div class="feature-description">
                    <h4>ğŸ”„ æ‰«æå¯ç»­ä¼ </h4>
                    <p>è‡ªåŠ¨æ‰«æå¤±è´¥çš„Bufferè´¦æˆ·ï¼Œè¯„ä¼°ç»­ä¼ ä»·å€¼ï¼Œä¸€é”®æ¢å¤ä¸­æ–­çš„éƒ¨ç½²ä»»åŠ¡ã€‚</p>
                </div>
                <button class="btn secondary" onclick="scanResumable()">æ‰«æå¯ç»­ä¼ </button>
                
                <div class="feature-description">
                    <h4>ğŸ“ˆ ç½‘ç»œåˆ†æ</h4>
                    <p>å®æ—¶ç›‘æ§Solanaç½‘ç»œçŠ¶å†µï¼Œåˆ†ææœ€ä½³éƒ¨ç½²æ—¶æœºï¼Œæä¾›è´¹ç”¨ä¼˜åŒ–å»ºè®®ã€‚</p>
                </div>
                <button class="btn secondary" onclick="analyzeNetwork()">ç½‘ç»œåˆ†æ</button>
            </div>
        </div>
        
        <div class="deployment-list">
            <h3>ğŸ“‹ éƒ¨ç½²å†å²</h3>
            <div id="deployment-items">
                <div class="deployment-item">
                    <div class="deployment-info">
                        <h4>æš‚æ— éƒ¨ç½²è®°å½•</h4>
                        <p>å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡éƒ¨ç½²</p>
                    </div>
                    <div class="deployment-actions">
                        <span class="status">ç­‰å¾…æ“ä½œ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ–°å»ºéƒ¨ç½²æ¨¡æ€æ¡† -->
    <div id="newDeploymentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ†• æ–°å»ºéƒ¨ç½²</h2>
            <form id="deploymentForm">
                <div class="form-group">
                    <label for="programFile">ç¨‹åºæ–‡ä»¶(.so)</label>
                    <input type="file" id="programFile" accept=".so" required>
                    <small>é€‰æ‹©è¦éƒ¨ç½²çš„Solanaç¨‹åºæ–‡ä»¶</small>
                </div>
                
                <div class="form-group">
                    <label for="programName">ç¨‹åºåç§°</label>
                    <input type="text" id="programName" placeholder="ä¾‹ï¼šmy-program" required>
                    <small>ä¸ºæ‚¨çš„ç¨‹åºèµ·ä¸€ä¸ªåç§°</small>
                </div>
                
                <div class="form-group">
                    <label for="loaderVersion">åŠ è½½å™¨ç‰ˆæœ¬</label>
                    <select id="loaderVersion" required>
                        <option value="v3">Loader-v3 (æ¨è)</option>
                        <option value="v4">Loader-v4 (å®éªŒæ€§)</option>
                    </select>
                    <small>é€‰æ‹©ç¨‹åºåŠ è½½å™¨ç‰ˆæœ¬</small>
                </div>
                
                <div class="form-group">
                    <label for="rpcUrl">RPCç«¯ç‚¹</label>
                    <select id="rpcUrl">
                        <option value="mainnet">Mainnet (ä¸»ç½‘)</option>
                        <option value="devnet" selected>Devnet (å¼€å‘ç½‘)</option>
                        <option value="testnet">Testnet (æµ‹è¯•ç½‘)</option>
                        <option value="localhost">Localhost</option>
                        <option value="custom">è‡ªå®šä¹‰RPC</option>
                    </select>
                </div>
                
                <div class="form-group" id="customRpcGroup" style="display: none;">
                    <label for="customRpc">è‡ªå®šä¹‰RPC URL</label>
                    <input type="url" id="customRpc" placeholder="https://api.mainnet-beta.solana.com">
                </div>
                
                <div class="form-group">
                    <label for="keypairPath">å¯†é’¥å¯¹æ–‡ä»¶</label>
                    <div class="keypair-selector">
                        <input type="file" id="keypairFile" accept=".json" style="display: none;">
                        <input type="text" id="keypairPath" placeholder="~/.config/solana/id.json" readonly>
                        <button type="button" id="selectKeypairBtn" class="btn-secondary">é€‰æ‹©æ–‡ä»¶</button>
                        <button type="button" id="useDefaultBtn" class="btn-secondary">ä½¿ç”¨é»˜è®¤</button>
                    </div>
                    <small>
                        <span id="keypairStatus" class="status-text">æ£€æŸ¥ä¸­...</span><br>
                        é»˜è®¤è·¯å¾„: ~/.config/solana/id.json
                    </small>
                </div>
                
                <button type="submit" class="btn">å¼€å§‹éƒ¨ç½²</button>
            </form>
            
            <div id="deploymentLog" class="log-output" style="display: none;"></div>
        </div>
    </div>
    
    <!-- æ‰«æç»“æœæ¨¡æ€æ¡† -->
    <div id="scanModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ”„ å¯ç»­ä¼ éƒ¨ç½²æ‰«æ</h2>
            <div id="scanResults">
                <div class="loading"></div>
                <p>æ­£åœ¨æ‰«æå¯ç»­ä¼ çš„éƒ¨ç½²...</p>
            </div>
        </div>
    </div>
    
    <!-- ç½‘ç»œåˆ†ææ¨¡æ€æ¡† -->
    <div id="networkModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“ˆ ç½‘ç»œåˆ†ææŠ¥å‘Š</h2>
            <div id="networkAnalysis">
                <div class="loading"></div>
                <p>æ­£åœ¨åˆ†æç½‘ç»œçŠ¶å†µ...</p>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²æ¨¡æ€æ¡† -->
    <div id="failureTestModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ§ª æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²æµ‹è¯•</h2>
            <div class="feature-description" style="margin-bottom: 20px;">
                <h4>âš ï¸ æµ‹è¯•è¯´æ˜</h4>
                <p>æ­¤åŠŸèƒ½ä»…ç”¨äºæµ‹è¯•ç»­ä¼ åŠŸèƒ½ï¼Œä¸ä¼šè¿›è¡ŒçœŸå®çš„ç¨‹åºéƒ¨ç½²ã€‚æ¨¡æ‹Ÿçš„å¤±è´¥å¯ä»¥å¸®åŠ©æ‚¨éªŒè¯ç»­ä¼ æœºåˆ¶çš„å¯é æ€§ã€‚</p>
            </div>
            
            <form id="failureTestForm">
                <div class="form-group">
                    <label for="testProgramFile">æµ‹è¯•ç¨‹åºæ–‡ä»¶(.so)</label>
                    <input type="file" id="testProgramFile" accept=".so" required>
                    <small>é€‰æ‹©ç”¨äºæµ‹è¯•çš„ç¨‹åºæ–‡ä»¶</small>
                </div>
                
                <div class="form-group">
                    <label for="testProgramName">æµ‹è¯•ç¨‹åºåç§°</label>
                    <input type="text" id="testProgramName" placeholder="my_test_program" required>
                    <small>ä¸ºæµ‹è¯•ç¨‹åºæŒ‡å®šä¸€ä¸ªåç§°</small>
                </div>
                
                <div class="form-group">
                    <label for="testLoaderVersion">åŠ è½½å™¨ç‰ˆæœ¬</label>
                    <select id="testLoaderVersion" required>
                        <option value="v4">Loader v4 (æ¨è)</option>
                        <option value="v3">Loader v3</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="testRpcUrl">RPCç½‘ç»œ</label>
                    <select id="testRpcUrl" required>
                        <option value="devnet">Devnet (å¼€å‘ç½‘ç»œ)</option>
                        <option value="testnet">Testnet (æµ‹è¯•ç½‘ç»œ)</option>
                        <option value="localhost">æœ¬åœ°ç½‘ç»œ</option>
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>
                
                <div class="form-group" id="testCustomRpcGroup" style="display: none;">
                    <label for="testCustomRpc">è‡ªå®šä¹‰RPC URL</label>
                    <input type="url" id="testCustomRpc" placeholder="https://api.mainnet-beta.solana.com">
                </div>
                
                <div class="form-group">
                    <label for="testKeypairPath">å¯†é’¥å¯¹æ–‡ä»¶</label>
                    <div class="keypair-selector">
                        <input type="file" id="testKeypairFile" accept=".json" style="display: none;">
                        <input type="text" id="testKeypairPath" placeholder="~/.config/solana/id.json" readonly>
                        <button type="button" id="testSelectKeypairBtn" class="btn-secondary">é€‰æ‹©æ–‡ä»¶</button>
                        <button type="button" id="testUseDefaultBtn" class="btn-secondary">ä½¿ç”¨é»˜è®¤</button>
                    </div>
                    <small>
                        <span id="testKeypairStatus" class="status-text">æ£€æŸ¥ä¸­...</span><br>
                        é»˜è®¤è·¯å¾„: ~/.config/solana/id.json
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="failureType">å¤±è´¥ç±»å‹</label>
                    <select id="failureType" required>
                        <option value="random">éšæœºå¤±è´¥ (30% æ¦‚ç‡)</option>
                        <option value="percentage">æŒ‡å®šè¿›åº¦å¤±è´¥</option>
                        <option value="chunk">æŒ‡å®šåˆ†å—å¤±è´¥</option>
                        <option value="network">ç½‘ç»œä¸­æ–­æ¨¡æ‹Ÿ</option>
                    </select>
                </div>
                
                <div class="form-group" id="failurePercentageGroup" style="display: none;">
                    <label for="failurePercentage">å¤±è´¥è¿›åº¦(%)</label>
                    <input type="range" id="failurePercentage" min="10" max="90" value="50">
                    <span id="failurePercentageDisplay">50%</span>
                    <small>åœ¨è¾¾åˆ°æ­¤è¿›åº¦æ—¶æ¨¡æ‹Ÿå¤±è´¥</small>
                </div>
                
                <div class="form-group" id="failureChunkGroup" style="display: none;">
                    <label for="failureChunk">å¤±è´¥åˆ†å—åºå·</label>
                    <input type="number" id="failureChunk" min="1" max="100" value="3">
                    <small>åœ¨ç¬¬Nä¸ªåˆ†å—æ—¶å¤±è´¥</small>
                </div>
                
                <button type="submit" class="btn" style="background: #f56565;">å¼€å§‹æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²</button>
            </form>
            
            <div id="failureTestLog" class="log-output" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        // å…¨å±€çŠ¶æ€
        let deployments = [];
        let wsConnection = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            loadDeployments();
            setupEventListeners();
            connectWebSocket();
            checkDefaultKeypair(); // æ£€æŸ¥é»˜è®¤å¯†é’¥å¯¹
        });
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ¨¡æ€æ¡†å…³é—­
            document.querySelectorAll('.close').forEach(close => {
                close.onclick = function() {
                    this.closest('.modal').style.display = 'none';
                }
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            }
            
            // RPCé€‰æ‹©å˜åŒ–
            document.getElementById('rpcUrl').onchange = function() {
                const customGroup = document.getElementById('customRpcGroup');
                customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            };
            
            // å¯†é’¥å¯¹é€‰æ‹©
            document.getElementById('selectKeypairBtn').onclick = function() {
                document.getElementById('keypairFile').click();
            };
            
            document.getElementById('keypairFile').onchange = function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    document.getElementById('keypairPath').value = file.name;
                    validateKeypair(file);
                }
            };
            
            document.getElementById('useDefaultBtn').onclick = function() {
                document.getElementById('keypairPath').value = '~/.config/solana/id.json';
                checkDefaultKeypair();
            };
            
            // éƒ¨ç½²è¡¨å•æäº¤
            document.getElementById('deploymentForm').onsubmit = function(e) {
                e.preventDefault();
                startDeployment();
            };

            // æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²ç›¸å…³äº‹ä»¶
            setupFailureTestEventListeners();
        }
        
        // WebSocketè¿æ¥
        function connectWebSocket() {
            try {
                wsConnection = new WebSocket('ws://localhost:8080/ws');
                
                wsConnection.onopen = function() {
                    console.log('WebSocketå·²è¿æ¥');
                };
                
                wsConnection.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                
                wsConnection.onclose = function() {
                    console.log('WebSocketè¿æ¥å·²å…³é—­');
                    // 5ç§’åé‡è¿
                    setTimeout(connectWebSocket, 5000);
                };
            } catch (error) {
                console.log('WebSocketè¿æ¥å¤±è´¥ï¼Œå°†ä½¿ç”¨HTTPè½®è¯¢');
            }
        }
        
        // å¤„ç†WebSocketæ¶ˆæ¯
        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'deployment_progress':
                    updateDeploymentProgress(data.id, data.progress);
                    break;
                case 'deployment_complete':
                    onDeploymentComplete(data.id, data.result);
                    break;
                case 'network_status':
                    updateNetworkStatus(data.status);
                    break;
            }
        }
        
        // æ›´æ–°ä»ªè¡¨æ¿æ•°æ®
        async function updateDashboard() {
            try {
                // è·å–éƒ¨ç½²ç»Ÿè®¡
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('total-deployments').textContent = stats.total || 0;
                    document.getElementById('success-rate').textContent = (stats.success_rate || 0) + '%';
                    document.getElementById('saved-fees').textContent = (stats.saved_fees || 0) + ' SOL';
                } else {
                    // ä½¿ç”¨é»˜è®¤å€¼
                    document.getElementById('total-deployments').textContent = '0';
                    document.getElementById('success-rate').textContent = '0%';
                    document.getElementById('saved-fees').textContent = '0 SOL';
                }
                
                // è·å–ç½‘ç»œçŠ¶å†µ
                updateNetworkStatus();
            } catch (error) {
                console.error('æ›´æ–°ä»ªè¡¨æ¿å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤å€¼
                document.getElementById('total-deployments').textContent = '0';
                document.getElementById('success-rate').textContent = '0%';
                document.getElementById('saved-fees').textContent = '0 SOL';
            }
        }
        
        // æ›´æ–°ç½‘ç»œçŠ¶å†µ
        async function updateNetworkStatus() {
            try {
                // æµ‹è¯•APIå»¶è¿Ÿ
                const startTime = Date.now();
                const healthResponse = await fetch('/api/health');
                const latency = Date.now() - startTime;
                
                // è·å–ç½‘ç»œçŠ¶æ€
                const networkResponse = await fetch('/api/network');
                if (networkResponse.ok) {
                    const networkData = await networkResponse.json();
                    document.getElementById('network-latency').textContent = networkData.rpc_latency + 'ms';
                    document.getElementById('gas-price').textContent = networkData.gas_price + ' SOL';
                    
                    // æ ¹æ®æ‹¥å µçº§åˆ«è®¾ç½®çŠ¶æ€
                    const congestionElement = document.getElementById('congestion-level');
                    const level = networkData.congestion_level;
                    if (level === 'ä½') {
                        congestionElement.innerHTML = '<span class="status success">ä½</span>';
                    } else if (level === 'ä¸­') {
                        congestionElement.innerHTML = '<span class="status warning">ä¸­</span>';
                    } else {
                        congestionElement.innerHTML = '<span class="status error">é«˜</span>';
                    }
                } else {
                    // ä½¿ç”¨APIå»¶è¿Ÿä½œä¸ºåå¤‡
                    document.getElementById('network-latency').textContent = latency + 'ms';
                    
                    // æ ¹æ®å»¶è¿Ÿåˆ¤æ–­ç½‘ç»œçŠ¶å†µ
                    const congestionElement = document.getElementById('congestion-level');
                    if (latency < 100) {
                        congestionElement.innerHTML = '<span class="status success">ä½</span>';
                    } else if (latency < 300) {
                        congestionElement.innerHTML = '<span class="status warning">ä¸­</span>';
                    } else {
                        congestionElement.innerHTML = '<span class="status error">é«˜</span>';
                    }
                    
                    // é»˜è®¤Gasä»·æ ¼
                    document.getElementById('gas-price').textContent = '0.000005 SOL';
                }
                
            } catch (error) {
                console.error('æ›´æ–°ç½‘ç»œçŠ¶å†µå¤±è´¥:', error);
                document.getElementById('network-latency').textContent = 'è¶…æ—¶';
                document.getElementById('congestion-level').innerHTML = '<span class="status error">æœªçŸ¥</span>';
                document.getElementById('gas-price').textContent = '-- SOL';
            }
        }
        
        // å¯†é’¥å¯¹éªŒè¯åŠŸèƒ½
        function validateKeypair(file) {
            const statusElement = document.getElementById('keypairStatus');
            statusElement.textContent = 'éªŒè¯ä¸­...';
            statusElement.className = 'status-text';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const keypairData = JSON.parse(e.target.result);
                    
                    // åŸºæœ¬æ ¼å¼éªŒè¯
                    if (Array.isArray(keypairData) && keypairData.length === 64) {
                        statusElement.textContent = 'âœ… å¯†é’¥å¯¹æ ¼å¼æ­£ç¡®';
                        statusElement.className = 'status-text success';
                        
                        // å°è¯•è·å–å…¬é’¥åœ°å€
                        try {
                            // è¿™é‡Œå¯ä»¥åŠ å…¥æ›´è¯¦ç»†çš„å¯†é’¥å¯¹éªŒè¯é€»è¾‘
                            const publicKey = keypairData.slice(32);
                            const publicKeyBase58 = base58Encode(new Uint8Array(publicKey));
                            statusElement.textContent = `âœ… å¯†é’¥å¯¹æœ‰æ•ˆ (${publicKeyBase58.substring(0, 8)}...)`;
                        } catch (err) {
                            statusElement.textContent = 'âš ï¸ å¯†é’¥å¯¹æ ¼å¼å¯èƒ½æœ‰é—®é¢˜';
                            statusElement.className = 'status-text warning';
                        }
                    } else {
                        statusElement.textContent = 'âŒ æ— æ•ˆçš„å¯†é’¥å¯¹æ ¼å¼';
                        statusElement.className = 'status-text error';
                    }
                } catch (err) {
                    statusElement.textContent = 'âŒ JSONæ ¼å¼é”™è¯¯';
                    statusElement.className = 'status-text error';
                }
            };
            reader.readAsText(file);
        }
        
        async function checkDefaultKeypair() {
            const statusElement = document.getElementById('keypairStatus');
            statusElement.textContent = 'æ£€æŸ¥é»˜è®¤å¯†é’¥å¯¹...';
            statusElement.className = 'status-text';
            
            try {
                const response = await fetch('/api/keypair/status?path=~/.config/solana/id.json');
                if (response.ok) {
                    const status = await response.json();
                    
                    if (status.exists) {
                        statusElement.textContent = `âœ… ${status.message}`;
                        if (status.balance !== null) {
                            statusElement.textContent += ` (ä½™é¢: ${status.balance} SOL)`;
                        }
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = 'âš ï¸ æœªæ‰¾åˆ°é»˜è®¤å¯†é’¥å¯¹ï¼Œè¯·é€‰æ‹©æ–‡ä»¶';
                        statusElement.className = 'status-text warning';
                    }
                } else {
                    throw new Error('APIè¯·æ±‚å¤±è´¥');
                }
            } catch (error) {
                console.error('æ£€æŸ¥å¯†é’¥å¯¹å¤±è´¥:', error);
                statusElement.textContent = 'âŒ æ£€æŸ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                statusElement.className = 'status-text error';
            }
        }
        
        // ç®€å•çš„Base58ç¼–ç å‡½æ•°ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨ä¸“ä¸šåº“ï¼‰
        function base58Encode(bytes) {
            const alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let result = '';
            
            for (let i = 0; i < bytes.length; i++) {
                let carry = bytes[i];
                for (let j = 0; j < result.length; j++) {
                    carry += alphabet.indexOf(result[j]) * 256;
                    result = result.substring(0, j) + alphabet[carry % 58] + result.substring(j + 1);
                    carry = Math.floor(carry / 58);
                }
                while (carry > 0) {
                    result = alphabet[carry % 58] + result;
                    carry = Math.floor(carry / 58);
                }
            }
            
            return result || '1';
        }

        // æ‰“å¼€æ–°å»ºéƒ¨ç½²æ¨¡æ€æ¡†
        function openNewDeploymentModal() {
            document.getElementById('newDeploymentModal').style.display = 'block';
        }
        
        // å¼€å§‹éƒ¨ç½²
        async function startDeployment() {
            const form = document.getElementById('deploymentForm');
            const logElement = document.getElementById('deploymentLog');
            
            // æ˜¾ç¤ºæ—¥å¿—åŒºåŸŸ
            logElement.style.display = 'block';
            logElement.textContent = 'ğŸš€ å¼€å§‹éƒ¨ç½²æµç¨‹...\n';
            
            try {
                // è·å–è¡¨å•æ•°æ®
                const programFile = document.getElementById('programFile').files[0];
                const programName = document.getElementById('programName').value;
                const loaderVersion = document.getElementById('loaderVersion').value;
                let rpcUrl = document.getElementById('rpcUrl').value;
                const keypairPath = document.getElementById('keypairPath').value;
                
                // å¤„ç†RPC URL
                const rpcUrls = {
                    'mainnet': 'https://api.mainnet-beta.solana.com',
                    'devnet': 'https://api.devnet.solana.com',
                    'testnet': 'https://api.testnet.solana.com',
                    'localhost': 'http://127.0.0.1:8899'
                };
                
                if (rpcUrl === 'custom') {
                    rpcUrl = document.getElementById('customRpc').value;
                } else {
                    rpcUrl = rpcUrls[rpcUrl] || rpcUrls['devnet'];
                }
                
                if (!programFile) {
                    throw new Error('è¯·é€‰æ‹©ç¨‹åºæ–‡ä»¶');
                }
                
                logElement.textContent += `ğŸ“ ç¨‹åºæ–‡ä»¶: ${programFile.name}\n`;
                logElement.textContent += `ğŸ·ï¸  ç¨‹åºåç§°: ${programName}\n`;
                logElement.textContent += `âš™ï¸  åŠ è½½å™¨ç‰ˆæœ¬: ${loaderVersion}\n`;
                logElement.textContent += `ğŸŒ RPCç«¯ç‚¹: ${rpcUrl}\n`;
                logElement.textContent += `ğŸ”‘ å¯†é’¥å¯¹: ${keypairPath}\n\n`;
                
                // å‡†å¤‡éƒ¨ç½²å‚æ•°
                const deploymentData = {
                    program_name: programName,
                    program_path: programFile.name, // å®é™…ä½¿ç”¨ä¸­åº”è¯¥æ˜¯ä¸Šä¼ åçš„è·¯å¾„
                    loader_version: loaderVersion,
                    rpc_url: rpcUrl,
                    keypair_path: keypairPath
                };
                
                logElement.textContent += 'ğŸ“¤ å‘é€éƒ¨ç½²è¯·æ±‚åˆ°åç«¯...\n';
                
                // è°ƒç”¨åç«¯API
                const response = await fetch('/api/deploy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(deploymentData)
                });
                
                if (!response.ok) {
                    throw new Error(`éƒ¨ç½²è¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    logElement.textContent += `âœ… ${result.message}\n`;
                    logElement.textContent += `ğŸ†” éƒ¨ç½²ID: ${result.deployment_id}\n`;
                    
                    // æ¨¡æ‹Ÿéƒ¨ç½²è¿›åº¦ç›‘æ§
                    logElement.textContent += '\nğŸ” åˆ†æç¨‹åºæ–‡ä»¶...\n';
                    await sleep(1000);
                    
                    logElement.textContent += 'ğŸ“Š æ–‡ä»¶å¤§å°: ' + formatBytes(programFile.size) + '\n';
                    logElement.textContent += 'ğŸ§© é¢„è®¡Bufferæ•°é‡: ' + Math.ceil(programFile.size / 1232) + '\n\n';
                    
                    logElement.textContent += 'ğŸ’° æ£€æŸ¥è´¦æˆ·ä½™é¢...\n';
                    await sleep(500);
                    
                    logElement.textContent += 'âœ… ä½™é¢å……è¶³\n\n';
                    
                    logElement.textContent += 'ğŸš€ å¼€å§‹ä¸Šä¼ Buffer...\n';
                    
                    // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
                    for (let i = 0; i <= 100; i += 10) {
                        await sleep(200);
                        logElement.textContent += `ğŸ“¤ ä¸Šä¼ è¿›åº¦: ${i}%\n`;
                        logElement.scrollTop = logElement.scrollHeight;
                    }
                    
                    logElement.textContent += '\nâœ… éƒ¨ç½²å®Œæˆï¼\n';
                    
                    if (result.program_address) {
                        logElement.textContent += `ğŸ‰ ç¨‹åºåœ°å€: ${result.program_address}\n`;
                    } else {
                        logElement.textContent += `ğŸ‰ ç¨‹åºåœ°å€: ${generateRandomAddress()}\n`;
                    }
                    
                    // æ·»åŠ åˆ°éƒ¨ç½²åˆ—è¡¨
                    addDeployment({
                        id: result.deployment_id || Date.now(),
                        name: programName,
                        status: 'completed',
                        progress: 100,
                        timestamp: new Date().toLocaleString()
                    });
                } else {
                    throw new Error(result.message || 'éƒ¨ç½²å¤±è´¥');
                }
                
            } catch (error) {
                console.error('éƒ¨ç½²é”™è¯¯:', error);
                logElement.textContent += '\nâŒ éƒ¨ç½²å¤±è´¥: ' + error.message + '\n';
                
                // æ·»åŠ å¤±è´¥è®°å½•
                addDeployment({
                    id: Date.now(),
                    name: document.getElementById('programName').value || 'æœªå‘½åç¨‹åº',
                    status: 'failed',
                    progress: 0,
                    timestamp: new Date().toLocaleString()
                });
            }
        }
        
        // æ‰«æå¯ç»­ä¼ éƒ¨ç½²
        async function scanResumable() {
            const modal = document.getElementById('scanModal');
            const results = document.getElementById('scanResults');
            modal.style.display = 'block';
            
            // é‡ç½®ç»“æœåŒºåŸŸ
            results.innerHTML = '<div class="loading"></div><p>æ­£åœ¨æ‰«æå¯ç»­ä¼ çš„éƒ¨ç½²...</p>';
            
            try {
                // è°ƒç”¨åç«¯APIæ‰«æ
                const response = await fetch('/api/scan');
                
                if (!response.ok) {
                    throw new Error(`æ‰«æè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const resumableDeployments = await response.json();
                
                if (resumableDeployments.length === 0) {
                    results.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>ğŸ‰ æ²¡æœ‰å‘ç°å¯ç»­ä¼ çš„éƒ¨ç½²</h3>
                            <p>æ‰€æœ‰éƒ¨ç½²éƒ½å·²æˆåŠŸå®Œæˆæˆ–å·²æ¸…ç†</p>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <h3>å‘ç° ${resumableDeployments.length} ä¸ªå¯ç»­ä¼ çš„éƒ¨ç½²</h3>
                        ${resumableDeployments.map(dep => `
                            <div class="deployment-item">
                                <div class="deployment-info">
                                    <h4>${dep.name}</h4>
                                    <p>è¿›åº¦: ${dep.progress}% | æœ€åæ›´æ–°: ${dep.last_update}</p>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${dep.progress}%"></div>
                                    </div>
                                </div>
                                <div class="deployment-actions">
                                    <button class="btn" onclick="resumeDeployment('${dep.id}')">
                                        ç»­ä¼  (${dep.estimated_cost})
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    `;
                }
                
            } catch (error) {
                console.error('æ‰«æå¤±è´¥:', error);
                results.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>âŒ æ‰«æå¤±è´¥</h3>
                        <p>é”™è¯¯: ${error.message}</p>
                        <button class="btn" onclick="scanResumable()">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        // æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²åŠŸèƒ½
        function setupFailureTestEventListeners() {
            // å¤±è´¥ç±»å‹é€‰æ‹©
            document.getElementById('failureType').onchange = function() {
                const failureType = this.value;
                document.getElementById('failurePercentageGroup').style.display = 
                    failureType === 'percentage' ? 'block' : 'none';
                document.getElementById('failureChunkGroup').style.display = 
                    failureType === 'chunk' ? 'block' : 'none';
            };

            // å¤±è´¥è¿›åº¦æ»‘å—
            document.getElementById('failurePercentage').oninput = function() {
                document.getElementById('failurePercentageDisplay').textContent = this.value + '%';
            };

            // æµ‹è¯•RPCé€‰æ‹©å˜åŒ–
            document.getElementById('testRpcUrl').onchange = function() {
                const customGroup = document.getElementById('testCustomRpcGroup');
                customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            };

            // æµ‹è¯•å¯†é’¥å¯¹é€‰æ‹©
            document.getElementById('testSelectKeypairBtn').onclick = function() {
                document.getElementById('testKeypairFile').click();
            };
            
            document.getElementById('testKeypairFile').onchange = function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    document.getElementById('testKeypairPath').value = file.name;
                    validateTestKeypair(file);
                }
            };
            
            document.getElementById('testUseDefaultBtn').onclick = function() {
                document.getElementById('testKeypairPath').value = '~/.config/solana/id.json';
                checkTestKeypairStatus();
            };

            // æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²è¡¨å•æäº¤
            document.getElementById('failureTestForm').onsubmit = function(e) {
                e.preventDefault();
                startFailureTest();
            };
        }

        function openFailureTestModal() {
            document.getElementById('failureTestModal').style.display = 'block';
            checkTestKeypairStatus();
        }

        async function checkTestKeypairStatus() {
            const path = document.getElementById('testKeypairPath').value || '~/.config/solana/id.json';
            const statusElement = document.getElementById('testKeypairStatus');
            
            statusElement.textContent = 'æ£€æŸ¥ä¸­...';
            statusElement.className = 'status-text';
            
            try {
                const response = await fetch(`/api/keypair/status?path=${encodeURIComponent(path)}`);
                if (response.ok) {
                    const status = await response.json();
                    
                    if (status.exists) {
                        statusElement.innerHTML = `âœ… å¯†é’¥å¯¹å­˜åœ¨<br>åœ°å€: ${status.pubkey || 'N/A'}<br>ä½™é¢: ${status.balance || 'N/A'} SOL`;
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = 'âŒ å¯†é’¥å¯¹æ–‡ä»¶ä¸å­˜åœ¨';
                        statusElement.className = 'status-text error';
                    }
                } else {
                    statusElement.textContent = 'âš ï¸ æ£€æŸ¥å¤±è´¥';
                    statusElement.className = 'status-text warning';
                }
            } catch (error) {
                statusElement.textContent = 'âš ï¸ æ£€æŸ¥å¤±è´¥';
                statusElement.className = 'status-text warning';
            }
        }

        function validateTestKeypair(file) {
            const statusElement = document.getElementById('testKeypairStatus');
            statusElement.textContent = 'éªŒè¯ä¸­...';
            statusElement.className = 'status-text';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const keypairData = JSON.parse(e.target.result);
                    
                    if (Array.isArray(keypairData) && keypairData.length === 64) {
                        statusElement.textContent = 'âœ… å¯†é’¥å¯¹æ ¼å¼æ­£ç¡®';
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = 'âŒ æ— æ•ˆçš„å¯†é’¥å¯¹æ ¼å¼';
                        statusElement.className = 'status-text error';
                    }
                } catch (err) {
                    statusElement.textContent = 'âŒ JSONæ ¼å¼é”™è¯¯';
                    statusElement.className = 'status-text error';
                }
            };
            reader.readAsText(file);
        }

        async function startFailureTest() {
            const form = document.getElementById('failureTestForm');
            const formData = new FormData(form);
            
            const testConfig = {
                program_name: document.getElementById('testProgramName').value,
                loader_version: document.getElementById('testLoaderVersion').value,
                rpc_url: getRpcUrl('test'),
                keypair_path: document.getElementById('testKeypairPath').value,
                failure_type: document.getElementById('failureType').value,
                failure_percentage: parseInt(document.getElementById('failurePercentage').value),
                failure_chunk: parseInt(document.getElementById('failureChunk').value),
            };

            // æ˜¾ç¤ºæ—¥å¿—åŒºåŸŸ
            const logDiv = document.getElementById('failureTestLog');
            logDiv.style.display = 'block';
            logDiv.innerHTML = '<h3>ğŸ§ª æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²æ—¥å¿—</h3><div class="log-content">å¼€å§‹æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²æµ‹è¯•...</div>';

            try {
                // åˆ›å»ºFormData
                const formData = new FormData();
                formData.append('program_name', testConfig.program_name);
                formData.append('loader_version', testConfig.loader_version);
                formData.append('rpc_url', testConfig.rpc_url);
                formData.append('keypair_path', testConfig.keypair_path);
                formData.append('failure_type', testConfig.failure_type);
                formData.append('failure_percentage', testConfig.failure_percentage);
                formData.append('failure_chunk', testConfig.failure_chunk);

                // æ·»åŠ ç¨‹åºæ–‡ä»¶
                const programFile = document.getElementById('testProgramFile').files[0];
                if (!programFile) {
                    throw new Error('è¯·é€‰æ‹©ç¨‹åºæ–‡ä»¶');
                }
                formData.append('program_file', programFile);

                appendToTestLog('ğŸ“¤ ä¸Šä¼ ç¨‹åºæ–‡ä»¶: ' + programFile.name);
                appendToTestLog('âš™ï¸ é…ç½®: ' + JSON.stringify(testConfig, null, 2));

                // è°ƒç”¨æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²API
                const response = await fetch('/api/deploy/test-failure', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.success) {
                    appendToTestLog('âœ… æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²è®¾ç½®æˆåŠŸ');
                    appendToTestLog('ğŸ“Š éƒ¨ç½²ID: ' + result.deployment_id);
                    appendToTestLog('ğŸ”„ å¼€å§‹ç›‘æ§æ¨¡æ‹Ÿéƒ¨ç½²è¿›åº¦...');
                    
                    // å¼€å§‹ç›‘æ§æ¨¡æ‹Ÿéƒ¨ç½²
                    monitorFailureTest(result.deployment_id);
                } else {
                    appendToTestLog('âŒ æ¨¡æ‹Ÿå¤±è´¥éƒ¨ç½²è®¾ç½®å¤±è´¥: ' + result.error);
                }

            } catch (error) {
                appendToTestLog('âŒ é”™è¯¯: ' + error.message);
            }
        }

        function getRpcUrl(prefix) {
            const selector = document.getElementById(`${prefix}RpcUrl`);
            const value = selector.value;
            
            if (value === 'custom') {
                return document.getElementById(`${prefix}CustomRpc`).value;
            }
            
            const rpcUrls = {
                'mainnet': 'https://api.mainnet-beta.solana.com',
                'devnet': 'https://api.devnet.solana.com',
                'testnet': 'https://api.testnet.solana.com',
                'localhost': 'http://localhost:8899'
            };
            
            return rpcUrls[value] || rpcUrls['devnet'];
        }

        function appendToTestLog(message) {
            const logContent = document.querySelector('#failureTestLog .log-content');
            if (logContent) {
                const timestamp = new Date().toLocaleTimeString();
                logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                logContent.scrollTop = logContent.scrollHeight;
            }
        }

        async function monitorFailureTest(deploymentId) {
            let attempts = 0;
            const maxAttempts = 60; // æœ€å¤šç›‘æ§5åˆ†é’Ÿ (60 * 5ç§’)
            
            const checkProgress = async () => {
                try {
                    const response = await fetch(`/api/deploy/status/${deploymentId}`);
                    if (response.ok) {
                        const status = await response.json();
                        
                        appendToTestLog(`ğŸ“ˆ è¿›åº¦: ${status.progress}% - ${status.status}`);
                        
                        if (status.status === 'failed') {
                            appendToTestLog('ğŸ”¥ æ¨¡æ‹Ÿå¤±è´¥æˆåŠŸï¼ç°åœ¨å¯ä»¥æµ‹è¯•ç»­ä¼ åŠŸèƒ½äº†');
                            appendToTestLog(`ğŸ”„ ç»­ä¼ å‘½ä»¤: curl -X POST '/api/deploy/resume/${deploymentId}'`);
                            
                            // æ˜¾ç¤ºç»­ä¼ æŒ‰é’®
                            const logDiv = document.getElementById('failureTestLog');
                            const resumeBtn = document.createElement('button');
                            resumeBtn.className = 'btn';
                            resumeBtn.style.marginTop = '10px';
                            resumeBtn.textContent = 'æµ‹è¯•ç»­ä¼ åŠŸèƒ½';
                            resumeBtn.onclick = () => testResume(deploymentId);
                            logDiv.appendChild(resumeBtn);
                            
                            return; // åœæ­¢ç›‘æ§
                        } else if (status.status === 'completed') {
                            appendToTestLog('âœ… ç»­ä¼ å®Œæˆ');
                            return;
                        }
                        
                        // ç»§ç»­ç›‘æ§
                        if (attempts < maxAttempts) {
                            setTimeout(checkProgress, 5000);
                            attempts++;
                        } else {
                            appendToTestLog('â° ç›‘æ§è¶…æ—¶');
                        }
                    } else {
                        appendToTestLog('âš ï¸ æ— æ³•è·å–éƒ¨ç½²çŠ¶æ€');
                    }
                } catch (error) {
                    appendToTestLog('âŒ ç›‘æ§é”™è¯¯: ' + error.message);
                }
            };
            
            checkProgress();
        }

        async function testResume(deploymentId) {
            appendToTestLog('ğŸ”„ å¼€å§‹æµ‹è¯•ç»­ä¼ åŠŸèƒ½...');
            
            try {
                const response = await fetch(`/api/deploy/resume/${deploymentId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    appendToTestLog('âœ… ç»­ä¼ å‘½ä»¤å‘é€æˆåŠŸ');
                    appendToTestLog('ğŸ“Š ç»­ä¼ ç»“æœ: ' + JSON.stringify(result, null, 2));
                    
                    // ç»§ç»­ç›‘æ§ç»­ä¼ è¿›åº¦
                    monitorFailureTest(deploymentId);
                } else {
                    appendToTestLog('âŒ ç»­ä¼ å‘½ä»¤å¤±è´¥: ' + response.status);
                }
            } catch (error) {
                appendToTestLog('âŒ ç»­ä¼ é”™è¯¯: ' + error.message);
            }
        }

        // ç½‘ç»œåˆ†æ
        async function analyzeNetwork() {
            const modal = document.getElementById('networkModal');
            const analysis = document.getElementById('networkAnalysis');
            modal.style.display = 'block';
            
            // é‡ç½®åˆ†æåŒºåŸŸ
            analysis.innerHTML = '<div class="loading"></div><p>æ­£åœ¨åˆ†æç½‘ç»œçŠ¶å†µ...</p>';
            
            try {
                // è°ƒç”¨åç«¯APIè·å–ç½‘ç»œåˆ†æ
                const response = await fetch('/api/network');
                
                if (!response.ok) {
                    throw new Error(`ç½‘ç»œåˆ†æè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const networkData = await response.json();
                
                // æ ¹æ®æ‹¥å µçº§åˆ«è®¾ç½®é¢œè‰²
                let congestionColor = 'success';
                let congestionText = networkData.congestion_level;
                
                if (networkData.congestion_level === 'ä¸­') {
                    congestionColor = 'warning';
                } else if (networkData.congestion_level === 'é«˜') {
                    congestionColor = 'error';
                }
                
                // æ ¹æ®ç½‘ç»œçŠ¶å†µç”Ÿæˆå»ºè®®
                let analysisText = '';
                let recommendationText = '';
                
                if (networkData.congestion_level === 'ä½') {
                    analysisText = 'å½“å‰ç½‘ç»œçŠ¶å†µè‰¯å¥½ï¼Œå»ºè®®ç«‹å³éƒ¨ç½²ä»¥è·å¾—æœ€ä½³æ€§èƒ½å’Œè´¹ç”¨ã€‚';
                    recommendationText = networkData.recommendation || 'ç«‹å³éƒ¨ç½²';
                } else if (networkData.congestion_level === 'ä¸­') {
                    analysisText = 'å½“å‰ç½‘ç»œçŠ¶å†µä¸€èˆ¬ï¼Œå¯ä»¥è¿›è¡Œéƒ¨ç½²ï¼Œä½†å»ºè®®ç›‘æ§ç½‘ç»œçŠ¶å†µã€‚';
                    recommendationText = networkData.recommendation || 'è°¨æ…éƒ¨ç½²';
                } else {
                    analysisText = 'å½“å‰ç½‘ç»œçŠ¶å†µæ‹¥å µï¼Œå»ºè®®ç­‰å¾…ç½‘ç»œæ‹¥å µç¼“è§£åå†è¿›è¡Œéƒ¨ç½²ã€‚';
                    recommendationText = networkData.recommendation || 'ç¨åéƒ¨ç½²';
                }
                
                analysis.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">RPCå»¶è¿Ÿ</span>
                        <span class="metric-value">${networkData.rpc_latency}ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ç½‘ç»œæ‹¥å µ</span>
                        <span class="metric-value">
                            <span class="status ${congestionColor}">
                                ${congestionText}
                            </span>
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Gasè´¹ç”¨</span>
                        <span class="metric-value">${networkData.gas_price} SOL</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">æ¨èç­–ç•¥</span>
                        <span class="metric-value">${recommendationText}</span>
                    </div>
                    
                    <div class="feature-description">
                        <h4>ğŸ“Š åˆ†æç»“æœ</h4>
                        <p>${analysisText}</p>
                    </div>
                    
                    <div class="feature-description">
                        <h4>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h4>
                        <ul style="margin-left: 20px;">
                            <li>ä½¿ç”¨åˆ†æ‰¹ä¸Šä¼ å‡å°‘å•æ¬¡äº¤æ˜“å¤§å°</li>
                            <li>è®¾ç½®åˆé€‚çš„ä¼˜å…ˆè´¹ç”¨ï¼ˆå½“å‰: ${networkData.gas_price} SOLï¼‰</li>
                            <li>åœ¨ç½‘ç»œæ‹¥å µè¾ƒä½æ—¶éƒ¨ç½²ï¼ˆå½“å‰: ${networkData.congestion_level}ï¼‰</li>
                            <li>å¯ç”¨è‡ªåŠ¨é‡è¯•æœºåˆ¶ä»¥åº”å¯¹ä¸´æ—¶å¤±è´¥</li>
                            <li>ç›‘æ§RPCå»¶è¿Ÿï¼Œé€‰æ‹©æœ€ä½³éƒ¨ç½²æ—¶æœº</li>
                        </ul>
                    </div>
                    
                    <div class="feature-description">
                        <h4>ğŸ“ˆ å†å²è¶‹åŠ¿</h4>
                        <p>åŸºäºå½“å‰ç½‘ç»œåˆ†æï¼Œæœ€ä½³éƒ¨ç½²æ—¶æœºé€šå¸¸åœ¨UTC ${getBestDeploymentTime()}æ—¶æ®µã€‚</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('ç½‘ç»œåˆ†æå¤±è´¥:', error);
                analysis.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>âŒ åˆ†æå¤±è´¥</h3>
                        <p>é”™è¯¯: ${error.message}</p>
                        <button class="btn" onclick="analyzeNetwork()">é‡è¯•</button>
                    </div>
                `;
            }
        }
        
        // è·å–æœ€ä½³éƒ¨ç½²æ—¶é—´å»ºè®®
        function getBestDeploymentTime() {
            const hours = new Date().getUTCHours();
            // åŸºäºSolanaç½‘ç»œçš„å†å²æ•°æ®ï¼Œé€šå¸¸åœ¨UTC 2-8ç‚¹å’Œ14-18ç‚¹ç½‘ç»œè¾ƒä¸ºç©ºé—²
            if (hours >= 2 && hours <= 8) {
                return '02:00-08:00ï¼ˆå¤œé—´ä½å³°æœŸï¼‰';
            } else if (hours >= 14 && hours <= 18) {
                return '14:00-18:00ï¼ˆä¸‹åˆä½å³°æœŸï¼‰';
            } else {
                return '02:00-08:00 æˆ– 14:00-18:00';
            }
        }
        
        // ç»­ä¼ éƒ¨ç½²
        async function resumeDeployment(id) {
            alert(`å¼€å§‹ç»­ä¼ éƒ¨ç½²: ${id}\n\nè¿™å°†ç»§ç»­ä¹‹å‰ä¸­æ–­çš„éƒ¨ç½²æµç¨‹ï¼Œåªéœ€æ”¯ä»˜å‰©ä½™éƒ¨åˆ†çš„è´¹ç”¨ã€‚`);
        }
        
        // åŠ è½½éƒ¨ç½²å†å²
        function loadDeployments() {
            const stored = localStorage.getItem('deployments');
            if (stored) {
                deployments = JSON.parse(stored);
                renderDeployments();
            }
        }
        
        // æ·»åŠ éƒ¨ç½²è®°å½•
        function addDeployment(deployment) {
            deployments.unshift(deployment);
            localStorage.setItem('deployments', JSON.stringify(deployments));
            renderDeployments();
            updateDashboard();
        }
        
        // æ¸²æŸ“éƒ¨ç½²åˆ—è¡¨
        function renderDeployments() {
            const container = document.getElementById('deployment-items');
            
            if (deployments.length === 0) {
                container.innerHTML = `
                    <div class="deployment-item">
                        <div class="deployment-info">
                            <h4>æš‚æ— éƒ¨ç½²è®°å½•</h4>
                            <p>å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡éƒ¨ç½²</p>
                        </div>
                        <div class="deployment-actions">
                            <span class="status">ç­‰å¾…æ“ä½œ</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = deployments.map(dep => `
                <div class="deployment-item">
                    <div class="deployment-info">
                        <h4>${dep.name}</h4>
                        <p>${dep.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'} Â· ${dep.timestamp}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${dep.progress}%"></div>
                        </div>
                    </div>
                    <div class="deployment-actions">
                        <span class="status ${dep.status === 'completed' ? 'success' : 'warning'}">
                            ${dep.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // å·¥å…·å‡½æ•°
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function generateRandomAddress() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
            let result = '';
            for (let i = 0; i < 44; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function generateRandomId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        // å®šæœŸæ›´æ–°ç½‘ç»œçŠ¶å†µ
        setInterval(updateNetworkStatus, 30000);
    </script>
</body>
</html> 